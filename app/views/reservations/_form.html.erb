<span id="reservationPartial"><%= render partial:"/reservations/errors" %></span>
<%= simple_form_for @reservation, remote: true do |f| %>
  <%= f.error_notification %>
  <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>

  <div class="form-inputs">
    <% if logged_in? %>
    <%= f.input_field :user_id, as: :hidden, value:  current_user.id %>
    <% end %>
    What service would you like?
    <%= f.association :service, :as => :grouped_select, :collection => ServiceType.order(:name), :group_method => :services, label: false, error:'Please select a service' %>
    <div class="form-inputs" id="stylist_select" style="display: none;">
    Which Stylist?
    <%= f.input :stylist_id, :as => :grouped_select, :collection => Service.order(:name), :group_method => :users, label_method: :first_name, label: false, include_blank: true %>
    </div>

    <!-- f.input :stylist_id, :collection => @stylist.order(:first_name), label_method: :first_name, value_method: :id, label: false, error:'Please select a stylist'     -->
    What date?
    <%= f.text_field :reservation_date, label: false, type: 'date', min: Date.today, max: Date.today.next_month(3), required: true, error:'Please select a date', class: 'form-control mt-1 mb-2'%>
    What time?
    <%= f.input :reservation_time, as: :time, label: false, ampm: true, start_hour: 9, end_hour: 19, minute_step: 15,  hint: 'We are only open bewteen 9:30 am & 7:00 pm', error:'Please choose a correct time', class: 'form-control p-1' %>
    <%= f.input :notes, label: 'Special Requests' %> 
  </div>

  <div class="form-actions">
    
    <% if logged_in? %>
      <%= f.button :submit, 'Submit', class: "btn btn-danger btn-block mb-1" %>
      <p class="hint-text text-center small text text-muted">Our staff members will contact you soon.</p>
    <% else %>
      <a href="#" data-target="#sign-in" data-toggle="modal" class="btn btn-block btn-danger">Submit</a>
    <% end %>
  </div>
<% end %>    

<script>
  jQuery(function() {
  var stylist;
  stylist = $('#reservation_stylist_id').html();
    console.log(stylist);
  return $('#reservation_service_id').change(function() {
    var service, escaped_service, options;
    service = $('#reservation_service_id :selected').text();
    escaped_service = service.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g, '\\$1');
    options = $(stylist).filter("optgroup[label=" + escaped_service + "]").html();
    console.log(options);
    if (options) {
      $('#reservation_stylist_id').html(options);
      return $('#stylist_select').show();
      // return $('#reservation_stylist_id').parent().show();
    } else {
      $('#reservation_stylist_id').empty();
      return $('#reservation_stylist_id').parent().hide();
       $('#stylist_select').hide();
    }
  });
});


</script>